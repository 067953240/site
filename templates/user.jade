extends base
-load staticfiles
-load gravatar
-load list_processor
-load markdown_trois_tags

block media
    style
        a.edit-profile {
            float: right;
            padding-top: 1em;
        }
        .user-problem-group h3 {
            font-weight: bold;
            font-size: 1.25em;
            margin-bottom: -10px;
            max-height: 20%;
            line-height: 2.5em;
        }
        .user-problem-group ul {
            -webkit-columns: 100px 4;
            -moz-columns: 100px 4;
            columns: 100px 4;
            list-style-type: none;
            margin-top: 0;
            margin-left: -20px;
            margin-bottom: 0px;
        }
        .user-problem-group a img {
            max-width: 1em;
            margin-right:3px;
            padding-bottom:1px;
            vertical-align: middle;
        }
        .user-gravatar {
            float: left;
        }
    link(rel='stylesheet', href='{% static "pygment-github.css" %}', type='text/css')

    script(type='text/javascript')
        $(function () {
            $('a.hide-group').click(function (event) {
                var a = this;
                var ul = $(this).parents('div.user-problem-group').find('ul');
                if (ul.is(':visible')) {
                    ul.slideUp('slow', function () {
                        $(a).html('<img src="{% static "icons/plus.png" %}"></img>');
                    });
                } else {
                    ul.slideDown('slow', function () {
                        $(a).html('<img src="{% static "icons/minus.png" %}"></img>');
                    });
                }
                event.preventDefault();
            });
        });

block header
    if user.user == request.user
        a.edit-profile(href='{% url "judge.views.edit_profile" %}')
            | Edit profile

block body
    br
    .user-gravatar
        img(src='{% gravatar user.user.email 128 %}', alt='gravatar')
    if user.name
        b Name: 
        | #{user.name}
        br
        br
    if user.about
        h4 About
        | #{user.about|markdown:"self-description"}
        br
    h4 #{user.problems} problems solved.
    b Total points:&nbsp;
    | #{user.calculate_points}
    br
    a(href='{% url "judge.views.all_user_submissions" user.user.username %}') View submissions
    br
    - regroup best_submissions by group as problems
    each group in problems
        div.user-problem-group
            h3
                a.hide-group.unselectable(href='#')
                    img(src='{% static "icons/minus.png" %}')
                | #{group.grouper}
                | (#{group.list|list_getitem:"points"|sum_list|floatformat:1} points)
            ul
                each entry in group.list
                    li
                        a(href='{% url "judge.views.problem" entry.code %}') #{entry.name}
                        = ' '
                        a(href='{% url "judge.views.user_submissions" entry.code user.user.username %}')
                            | (#{entry.points} / #{entry.total})
