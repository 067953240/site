{% extends "base.html" %}
{% load static from staticfiles %}
{% block css %}
    <script src="{% static 'simple-comet.js' %}" type="text/javascript"></script>
    <script src="{% static 'common.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            function on_receive(message) {
                var packet = message.split(" ");
                var list = document.getElementById("test-cases");
                switch (packet[0]) {
                    case "test-case":
                        list.innerHTML += "<b>Test case #{0}:</b> {1} [{2}s, {3}kb] ({4}/{5})<br/>".format(packet[1], packet[2], packet[3], packet[4], packet[5], packet[6]);
                        break;
                    case "grading-end":
                        list.innerHTML += "<br/><br/><b>Final score: {0}/{1}</b><br/>".format(packet[3], packet[4]);
                        break;
                    default:
                        return;
                }
            }

            SimpleComet.subscribe("{{ SIMPLE_COMET_URL }}sub_{{ submission.id }}.jsonp", function (resp) {
                var messages = resp['messages']['sub_{{ submission.id }}'];
                for (var i = 0; i < messages.length; ++i) {
                    on_receive(messages[i].content);
                }
            });
            SimpleComet.start();
        });
    </script>
{% endblock %}
{% block body %}
    Submitted on {{ submission.date }}
    <br/>
    {% if request.user == submission.user.user %}
        <a href="{% url 'judge.views.problem_submit' submission.problem.code %}">Click here to revise and resubmit!</a>
        <br/>
    {% endif %}
    <br/>
    <br/>
    <h3>Execution Results</h3>
    <br/>
    <div id="test-cases"></div>
{% endblock %}
