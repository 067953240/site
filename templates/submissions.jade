extends base
-load staticfiles

block media
    link(rel='stylesheet', href='{% static "status.css" %}')
    script(type='text/javascript', src='{% static "common.js" %}')
    script(type='text/javascript', src='{% static "event.js" %}')
    style
        #submissions-table {
            width: 75%;
            border: 0;
            margin-left: 0
        }

        td.sub-result {
            min-width: 80px;
        }

        td.sub-result .state {
            font-size: 0.7em;
            font-weight: bold;
            padding-top: 0.5em
        }

        td.sub-result .score {
            font-size: 1.3em;
            color: black
        }

        td.sub-info {
            width: 90%;
            text-align: left;
            padding-left: 20px;
            border-right: none;
        }

        td.sub-info-grading {
            width: auto !important;
            min-width: 58% !important;
        }

        td.sub-testcase {
            color: #555;
            min-width: 32%;
            vertical-align: middle;
            text-align: right;
            padding-right: 2%;
            border-right: none;
        }

        td.sub-info .name {
            font-size: 1.3em;
            font-weight: bold
        }

        td.sub-info .time {
            color: #555
        }

        td.sub-prop, td.sub-usage {
            white-space: nowrap;
        }

        td.sub-usage .time {
            font-weight: bold;
        }

    if dynamic_update
        script(type='text/javascript')
            $(function () {
                var table = $('#submissions-table');
                var statistics = $("#statistics-table");
                var doing_ajax = false;

                var update_submission = function (id, force) {
                    var cell = table.find('tr#' + id);
                    if (cell.length < 1) {
                        table.prepend('<tr id="{0}"></tr>'.format(id));
                        cell = table.find('tr#' + id);
                    }
                    if (force || !doing_ajax) {
                        if (!force) doing_ajax = true;
                        $.ajax({
                            url: '{% url "judge.views.single_submission_query" %}',
                            data: {id: id}
                        }).done(function (data) {
                            cell.html(data);
                            if (!force) doing_ajax = false;
                        }).fail(function () {
                            console.log('Failed to update submission: ' + id);
                            if (!force) doing_ajax = false;
                        });
                    }
                };

                var receiver = new EventReceiver(
                        "{{ EVENT_DAEMON_LOCATION }}", "{{ EVENT_DAEMON_POLL_LOCATION }}",
                        ['submissions'], #{last_msg}, function (message) {
                            if (message.type == 'update-submission') {
                                update_submission(message.id);
                            } else if (message.type == 'done-submission') {
                                update_submission(message.id, true);

                                $.ajax({
                                    url: '{% url "judge.views.statistics_table_query" %}'
                                }).done(function (data) {
                                    statistics.html(data);
                                }).fail(function () {
                                    console.log('Failed to update statistics table!' + id);
                                });
                            }
                        }
                );
            });
    script(type='text/javascript')
        $(function () {
            fix_div($('.info-float'), 40, true, function (info) {
                info.css('width', (info.width() / $(window).width() * 100) + '%');
                return $('<div/>', {
                    id: 'fake-info-float',
                    class: 'info-float'
                }).css('width', '20%').height(info.height()).prependTo('#content-body');
            });
        });


block body
    .info-float(style='width:20%')
        #statistics-table
            include problem_statistics_table
    if submissions.num_pages > 1
        div(style='margin-bottom:10px;')
            include submissions_pages

    table#submissions-table.table
        each submission in submissions
            tr(id=submission.id)
                include submission_row

    if submissions.num_pages > 1
        div(style='margin-top:10px;')
            include submissions_pages
